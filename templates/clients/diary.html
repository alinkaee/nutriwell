{% extends 'accounts/base_dashboard.html' %}

{% block title %}–î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è ‚Äî –ß–∏—Å—Ç—ã–π –ë–∞–ª–∞–Ω—Å{% endblock %}

{% block content %}
<style>
  .nutrition-values {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem 1.5rem;
    align-items: center;
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .nutrition-value-item {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    white-space: nowrap;
    font-size: 0.9rem;
  }

  .nutrition-value-label {
    font-weight: 600;
    color: #495057;
  }

  .nutrition-value-amount {
    color: #212529;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */

  /* –ë–æ–ª—å—à–∏–µ –¥–µ—Å–∫—Ç–æ–ø—ã (–±–æ–ª–µ–µ 1400px) */
  @media (min-width: 1400px) {
    .nutrition-values {
      gap: 1rem 2rem;
    }

    .nutrition-value-item {
      font-size: 0.95rem;
    }
  }

  /* –ù–æ—É—Ç–±—É–∫–∏ –∏ –¥–µ—Å–∫—Ç–æ–ø—ã (992px - 1399px) */
  @media (min-width: 992px) and (max-width: 1399px) {
    .nutrition-values {
      gap: 0.5rem 1.25rem;
    }
  }

  /* –ü–ª–∞–Ω—à–µ—Ç—ã (768px - 991px) */
  @media (min-width: 768px) and (max-width: 991px) {
    .nutrition-values {
      gap: 0.5rem 1rem;
    }

    .nutrition-value-item {
      font-size: 0.85rem;
    }
  }

  /* –ë–æ–ª—å—à–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã (576px - 767px) */
  @media (min-width: 576px) and (max-width: 767px) {
    .nutrition-values {
      gap: 0.5rem 0.75rem;
      justify-content: flex-start;
    }

    .nutrition-value-item {
      font-size: 0.82rem;
    }
  }

  /* –°—Ä–µ–¥–Ω–∏–µ –∏ –º–∞–ª–µ–Ω—å–∫–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã (–¥–æ 575px) */
  @media (max-width: 575px) {
    .nutrition-values {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.4rem;
    }

    .nutrition-value-item {
      font-size: 0.8rem;
      width: 100%;
      justify-content: space-between;
      padding: 0.1rem 0;
    }

    .nutrition-value-label {
      min-width: 70px;
    }

    .nutrition-value-amount {
      text-align: right;
    }
  }

  /* –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã (–¥–æ 400px) */
  @media (max-width: 400px) {
    .nutrition-values {
      gap: 0.3rem;
    }

    .nutrition-value-item {
      font-size: 0.78rem;
    }

    .nutrition-value-label {
      min-width: 60px;
    }
  }

  /* –õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
  @media (max-height: 500px) and (orientation: landscape) {
    .nutrition-values {
      flex-direction: row;
      flex-wrap: wrap;
      gap: 0.5rem 1rem;
    }

    .nutrition-value-item {
      font-size: 0.8rem;
      width: auto;
      justify-content: flex-start;
    }
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
  .card {
    transition: transform 0.2s ease;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
  .card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    font-weight: 600;
    color: #2c3e50;
  }

  /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
  .action-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  @media (max-width: 575px) {
    .action-buttons {
      flex-direction: column;
      width: 100%;
    }

    .action-buttons a {
      width: 100%;
      text-align: center;
    }
  }

  /* –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ */
  @media (min-width: 768px) {
    .col-md-6 {
      margin-bottom: 1rem;
    }
  }

  @media (max-width: 767px) {
    .col-md-6 {
      margin-bottom: 0.75rem;
    }

    .card {
      margin-bottom: 0.75rem;
    }
  }
</style>

<h2><i class="bi bi-journal-text me-2"></i>–î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</h2>

<div class="mb-4">
  <a href="{% url 'diaries:add_diary_entry' %}" class="btn btn-primary">+ –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</a>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
<div class="modal fade" id="addEntryModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form method="post">
          {% csrf_token %}
          {{ form.as_p }}
          <div class="mt-3">
            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π -->
<div class="row">
{% for entry in entries %}
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>{{ entry.date|date:"d E Y" }} {% if entry.time %}{{ entry.time|time:"H:i" }}{% endif %}</span>
      </div>
      <div class="card-body">
        {% if entry.product %}
          <p><strong>–ü—Ä–æ–¥—É–∫—Ç:</strong> {{ entry.product.name }}</p>
        {% elif entry.food_description %}
          <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ entry.food_description }}</p>
        {% endif %}

        <!-- –í—ã–≤–æ–¥–∏–º –ë–ñ–£ –∏ –∫–∞–ª–æ—Ä–∏–∏ -->
        {% if entry.calories or entry.protein or entry.fat or entry.carbs %}
          <hr>
          <div class="nutrition-values">
            {% if entry.calories %}
              <div class="nutrition-value-item">
                <span class="nutrition-value-label">–ö–∫–∞–ª:</span>
                <span class="nutrition-value-amount">{{ entry.calories }} –∫–∫–∞–ª</span>
              </div>
            {% endif %}
            {% if entry.protein %}
              <div class="nutrition-value-item">
                <span class="nutrition-value-label">–ë–µ–ª–∫–∏:</span>
                <span class="nutrition-value-amount">{{ entry.protein }} –≥</span>
              </div>
            {% endif %}
            {% if entry.fat %}
              <div class="nutrition-value-item">
                <span class="nutrition-value-label">–ñ–∏—Ä—ã:</span>
                <span class="nutrition-value-amount">{{ entry.fat }} –≥</span>
              </div>
            {% endif %}
            {% if entry.carbs %}
              <div class="nutrition-value-item">
                <span class="nutrition-value-label">–£–≥–ª–µ–≤–æ–¥—ã:</span>
                <span class="nutrition-value-amount">{{ entry.carbs }} –≥</span>
              </div>
            {% endif %}
          </div>
        {% endif %}

        {% if entry.notes %}
          <hr>
          <p class="mb-0"><small><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:</strong> {{ entry.notes }}</small></p>
        {% endif %}

        <div class="mt-3 d-flex justify-content-end gap-2 action-buttons">
          <a href="{% url 'diaries:edit_diary_entry' entry.id %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <a href="{% url 'diaries:delete_diary_entry' entry.id %}" class="btn btn-sm btn-outline-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
        </div>
      </div>
    </div>
  </div>
{% empty %}
  <div class="col-12">
    <div class="card">
      <div class="card-body text-center py-5">
        <i class="bi bi-journal-x display-4 text-muted mb-3"></i>
        <p class="text-muted mb-0">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ.</p>
        <p class="text-muted small mt-2">–ù–∞—á–Ω–∏—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ—ë –ø–∏—Ç–∞–Ω–∏–µ, –¥–æ–±–∞–≤–∏–≤ –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å.</p>
      </div>
    </div>
  </div>
{% endfor %}
</div>

{% endblock %}